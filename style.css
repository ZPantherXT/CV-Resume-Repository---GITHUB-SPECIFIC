const KEY = "AIzaSyDmmJ-zRqsCvY_mfESR8G5hcim7b5I9xrM"; 
let m = "";

async function start(mode) {
    m = mode;
    document.getElementById('landing').style.display = 'none';
    document.getElementById('builder').style.display = 'grid';
    // Specialist text: Weight 400 (Thinner)
    document.getElementById('chat').innerHTML = `<div class="spec-msg"><b>Specialist:</b> Session initiated. State your Name and Job Role.</div>`;
}

function send() {
    const i = document.getElementById('in');
    if (i.value.trim()) {
        document.getElementById('chat').innerHTML += `<div style="margin-bottom:15px; color:#ccc;"><b>User:</b> ${i.value}</div>`;
        callAI(i.value);
        i.value = '';
    }
}

async function callAI(userInput) {
    try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${KEY}`, {
            method: "POST", headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ contents: [{ parts: [{ text: `Persona: Specialist. Task: Building a ${m}. User: "${userInput}". Return ONLY JSON: {"reply":"msg","name":"n","role":"r","summary":"s","experience":"<li>x</li>"}` }] }] })
        });
        
        if (!response.ok) throw new Error();
        
        const data = await response.json();
        const clean = JSON.parse(data.candidates[0].content.parts[0].text.replace(/```json|```/g, "").trim());
        
        document.getElementById('chat').innerHTML += `<div class="spec-msg"><b>Specialist:</b> ${clean.reply}</div>`;
        if (clean.name) document.getElementById('n').innerText = clean.name;
        
    } catch (error) {
        // Updated error text with Bold Red styling
        document.getElementById('chat').innerHTML += `
            <div class="error-msg">CRITICAL: Connection to Specialist server lost.</div>`;
    }
    document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
}
